<EditForm Model="@Domain" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label for="name" class="form-label">Domain Name <span class="text-danger">*</span></label>
        <InputText id="name" @bind-Value="Domain.Name" class="form-control" placeholder="e.g., Cloud Computing, Machine Learning" />
        <ValidationMessage For="@(() => Domain.Name)" class="invalid-feedback d-block" />
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <InputTextArea id="description" @bind-Value="Domain.Description" class="form-control" rows="3"
                       placeholder="Brief description of this domain..." />
        <ValidationMessage For="@(() => Domain.Description)" class="invalid-feedback d-block" />
    </div>

    <div class="mb-3">
        <label class="form-label">Color</label>
        <div class="d-flex flex-wrap gap-2">
            @foreach (var color in DomainColors.Available)
            {
                <button type="button"
                        class="btn rounded-circle p-0 @(Domain.Color == color ? "ring-2" : "")"
                        style="width: 32px; height: 32px; background-color: @color; border: @(Domain.Color == color ? "3px solid #212529" : "2px solid transparent");"
                        @onclick="() => Domain.Color = color"
                        aria-label="Select color @color"
                        title="Select this color">
                    @if (Domain.Color == color)
                    {
                        <i class="bi bi-check text-white"></i>
                    }
                </button>
            }
        </div>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary" disabled="@IsSubmitting">
            @if (IsSubmitting)
            {
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            }
            @(IsEdit ? "Update Domain" : "Create Domain")
        </button>
        <button type="button" class="btn btn-outline-secondary" @onclick="OnCancel">
            Cancel
        </button>
    </div>

    @if (ValidationErrors.Count > 0)
    {
        <div class="alert alert-danger mt-3" role="alert">
            <ul class="mb-0">
                @foreach (var error in ValidationErrors)
                {
                    <li>@error</li>
                }
            </ul>
        </div>
    }
</EditForm>

@code {
    [Parameter] public Domain Domain { get; set; } = new();
    [Parameter] public bool IsEdit { get; set; }
    [Parameter] public bool IsSubmitting { get; set; }
    [Parameter] public List<string> ValidationErrors { get; set; } = new();
    [Parameter] public EventCallback<Domain> OnSubmit { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    private async Task HandleSubmit()
    {
        if (OnSubmit.HasDelegate)
        {
            await OnSubmit.InvokeAsync(Domain);
        }
    }
}
